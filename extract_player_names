#!/bin/bash

# Change the directory to the log folder
cd /home/mcserver/minecraft/logs

# Initialize an associative array to store player names and their occurrence counts
declare -A player_counts
declare -A player_dates

# Loop through each .gz file in the directory
for file in *.gz; do
    # Use zgrep to search for player names and count their occurrences
    # The regular expression ' joined the game' will match lines with player names followed by ' joined the game'
    # The -o option for grep only prints the matching part of the line.
    # The -h option for zgrep suppresses filenames in the output.
    names_found=$(zgrep -oE '[[:alnum:]_]+ joined the game' "$file" | awk '{print $1}')

    # Increment the occurrence count for each player name
    for name in $names_found; do
        player_counts["$name"]=$(( player_counts["$name"] + 1 ))
    done

    for name in $names_found; do
        player_dates["$name"]=$(date -r "$file" +%Y-%m-%d)
    done
done

# Format the player names with occurrence counts
formatted_names=()
for name in "${!player_counts[@]}"; do
    formatted_names+=("\"$name:${player_counts[$name]}:${player_dates[$name]}\"")
done

# Join the formatted player names with spaces
search_strings=$(IFS=" " ; echo "${formatted_names[*]}")

# Print out the formatted player names with occurrence counts
echo "$search_strings"
